{"remainingRequest":"/Users/ianwow/development/aws-content-analysis/source/website/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/ianwow/development/aws-content-analysis/source/website/src/components/TechnicalCues.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/ianwow/development/aws-content-analysis/source/website/src/components/TechnicalCues.vue","mtime":1631830990690},{"path":"/Users/ianwow/development/aws-content-analysis/source/website/node_modules/cache-loader/dist/cjs.js","mtime":1633407346687},{"path":"/Users/ianwow/development/aws-content-analysis/source/website/node_modules/babel-loader/lib/index.js","mtime":1633407348173},{"path":"/Users/ianwow/development/aws-content-analysis/source/website/node_modules/cache-loader/dist/cjs.js","mtime":1633407346687},{"path":"/Users/ianwow/development/aws-content-analysis/source/website/node_modules/vue-loader/lib/index.js","mtime":1633407348650}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBMb2FkaW5nIGZyb20gJ0AvY29tcG9uZW50cy9Mb2FkaW5nLnZ1ZScKaW1wb3J0IHsgbWFwU3RhdGUgfSBmcm9tICd2dWV4JwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIlRlY2huaWNhbEN1ZXMiLAogIGNvbXBvbmVudHM6IHsKICAgIExvYWRpbmcKICB9LAogIHByb3BzOiB7CiAgICBtZWRpYVR5cGU6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAiIgogICAgfSwKICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBjdXJsQ29tbWFuZDogJycsCiAgICAgIHNlYXJjaFF1ZXJ5OiAnJywKICAgICAgc2hvd0VsYXN0aWNzZWFyY2hBcGlSZXF1ZXN0OiBmYWxzZSwKICAgICAgc29ydEJ5OiAnU3RhcnRUaW1lY29kZVNNUFRFJywKICAgICAgY3VycmVudFBhZ2U6IDEsCiAgICAgIHBlclBhZ2U6IDUsCiAgICAgIGVuZFRpbWVzdGFtcDogbnVsbCwKICAgICAgZmllbGRzOiBbCiAgICAgICAgewogICAgICAgICAgJ1R5cGUnOiB7CiAgICAgICAgICAgIGxhYmVsOiAnVHlwZScsCiAgICAgICAgICAgIHNvcnRhYmxlOiB0cnVlCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAnU3RhcnRUaW1lY29kZVNNUFRFJzogewogICAgICAgICAgICBsYWJlbDogJ1N0YXJ0JywKICAgICAgICAgICAgc29ydGFibGU6IHRydWUKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICdFbmRUaW1lY29kZVNNUFRFJzogewogICAgICAgICAgICBsYWJlbDogJ0VuZCcsCiAgICAgICAgICAgIHNvcnRhYmxlOiBmYWxzZQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAnRHVyYXRpb25TTVBURSc6IHsKICAgICAgICAgICAgbGFiZWw6ICdEdXJhdGlvbicsCiAgICAgICAgICAgIHNvcnRhYmxlOiB0cnVlCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHsga2V5OiAnQ29uZmlkZW5jZScsIHNvcnRhYmxlOiB0cnVlIH0KICAgICAgXSwKICAgICAgZWxhc3RpY3NlYXJjaF9kYXRhOiBbXSwKICAgICAgaXNCdXN5OiBmYWxzZSwKICAgICAgb3BlcmF0b3I6ICd0ZWNobmljYWxfY3VlX2RldGVjdGlvbicsCiAgICB9CiAgfSwKICBjb21wdXRlZDogewogICAgLi4ubWFwU3RhdGUoWydwbGF5ZXInXSksCiAgICAuLi5tYXBTdGF0ZShbJ2N1cnJlbnRfdGltZSddKSwKICAgIHJvd3MoKSB7CiAgICAgIHJldHVybiB0aGlzLmVsYXN0aWNzZWFyY2hfZGF0YS5sZW5ndGgKICAgIH0KICB9LAogIHdhdGNoOiB7CiAgICBjdXJyZW50X3RpbWUodGltZSkgewogICAgICBpZiAodGhpcy5lbmRUaW1lc3RhbXAgIT0gbnVsbCkgewogICAgICAgIGlmICh0aW1lID09IHRoaXMuZW5kVGltZXN0YW1wIHx8IHRpbWUgPiB0aGlzLmVuZFRpbWVzdGFtcCkgewogICAgICAgICAgdGhpcy5wbGF5ZXIucGF1c2UoKTsKICAgICAgICAgIHRoaXMuZW5kVGltZXN0YW1wID0gbnVsbAogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sCiAgbW91bnRlZDogZnVuY3Rpb24oKSB7CiAgICB0aGlzLmdldEN1cmxDb21tYW5kKCk7CiAgfSwKICBiZWZvcmVEZXN0cm95OiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmVsYXN0aWNzZWFyY2hfZGF0YSA9IFtdOwogIH0sCiAgZGVhY3RpdmF0ZWQ6IGZ1bmN0aW9uICgpIHsKICAgIGNvbnNvbGUubG9nKCdkZWFjdGl2YXRlZCBjb21wb25lbnQ6JywgdGhpcy5vcGVyYXRvcik7CiAgfSwKICBhY3RpdmF0ZWQ6IGZ1bmN0aW9uICgpIHsKICAgIGNvbnNvbGUubG9nKCdhY3RpdmF0ZWQgY29tcG9uZW50OicsIHRoaXMub3BlcmF0b3IpCiAgICB0aGlzLmZldGNoQXNzZXREYXRhKCk7CiAgfSwKICBtZXRob2RzOiB7CiAgICBnZXRDdXJsQ29tbWFuZCgpIHsKICAgICAgdGhpcy5zZWFyY2hRdWVyeSA9ICdBc3NldElkOicrdGhpcy4kcm91dGUucGFyYW1zLmFzc2V0X2lkKycgT3BlcmF0b3I6Jyt0aGlzLm9wZXJhdG9yOwogICAgICAvLyBnZXQgY3VybCBjb21tYW5kIHRvIHNlYXJjaCBlbGFzdGljc2VhcmNoCiAgICAgIHRoaXMuY3VybENvbW1hbmQgPSAnYXdzY3VybCAtWCBHRVQgLS1wcm9maWxlIGRlZmF1bHQgLS1zZXJ2aWNlIGVzIC0tcmVnaW9uICcgKyB0aGlzLkFXU19SRUdJT04gKyAnIFwnJyArIHRoaXMuRUxBU1RJQ1NFQVJDSF9FTkRQT0lOVCArICcvX3NlYXJjaD9xPScgKyBlbmNvZGVVUklDb21wb25lbnQodGhpcy5zZWFyY2hRdWVyeSkgKyAnXCcnCiAgICB9LAogICAgc2V0UGxheWVyVGltZShlbmRNaWxsaXNlbmNvbmRzLCBzdGFydE1pbGxpc2Vjb25kcykgewogICAgICB0aGlzLmVuZFRpbWVzdGFtcCA9IGVuZE1pbGxpc2VuY29uZHMgLyAxMDAwCiAgICAgIGxldCBzZWNvbmRzID0gc3RhcnRNaWxsaXNlY29uZHMgLyAxMDAwCiAgICAgIHRoaXMucGxheWVyLmN1cnJlbnRUaW1lKHNlY29uZHMpOwogICAgICB0aGlzLnBsYXllci5wbGF5KCk7CiAgICB9LAogICAgc2F2ZUZpbGUoKSB7CiAgICAgIGNvbnN0IGVsYXN0aWNzZWFyY2hfZGF0YSA9IEpTT04uc3RyaW5naWZ5KHRoaXMuZWxhc3RpY3NlYXJjaF9kYXRhKTsKICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtlbGFzdGljc2VhcmNoX2RhdGFdLCB7dHlwZTogJ3RleHQvcGxhaW4nfSk7CiAgICAgIGNvbnN0IGUgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnTW91c2VFdmVudHMnKSwKICAgICAgICBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICBhLmRvd25sb2FkID0gImRhdGEuanNvbiI7CiAgICAgIGEuaHJlZiA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpOwogICAgICBhLmRhdGFzZXQuZG93bmxvYWR1cmwgPSBbJ3RleHQvanNvbicsIGEuZG93bmxvYWQsIGEuaHJlZl0uam9pbignOicpOwogICAgICBlLmluaXRFdmVudCgnY2xpY2snLCB0cnVlLCBmYWxzZSwgd2luZG93LCAwLCAwLCAwLCAwLCAwLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgMCwgbnVsbCk7CiAgICAgIGEuZGlzcGF0Y2hFdmVudChlKTsKICAgIH0sCiAgICBhc3luYyBmZXRjaEFzc2V0RGF0YSAoKSB7CiAgICAgICAgbGV0IHF1ZXJ5ID0gJ0Fzc2V0SWQ6Jyt0aGlzLiRyb3V0ZS5wYXJhbXMuYXNzZXRfaWQrJyBPcGVyYXRvcjonK3RoaXMub3BlcmF0b3I7CiAgICAgICAgbGV0IGFwaU5hbWUgPSAnY29udGVudEFuYWx5c2lzRWxhc3RpY3NlYXJjaCc7CiAgICAgICAgbGV0IHBhdGggPSAnL19zZWFyY2gnOwogICAgICAgIGxldCBhcGlQYXJhbXMgPSB7CiAgICAgICAgICBoZWFkZXJzOiB7J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ30sCiAgICAgICAgICBxdWVyeVN0cmluZ1BhcmFtZXRlcnM6IHsncSc6IHRoaXMuc2VhcmNoUXVlcnksICdkZWZhdWx0X29wZXJhdG9yJzogJ0FORCcsICdzaXplJzogMTAwMDB9CiAgICAgICAgfTsKICAgICAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLiRBbXBsaWZ5LkFQSS5nZXQoYXBpTmFtZSwgcGF0aCwgYXBpUGFyYW1zKTsKICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSkKICAgICAgICBpZiAoIXJlc3BvbnNlKSB7CiAgICAgICAgICB0aGlzLnNob3dFbGFzdGljU2VhcmNoQWxlcnQgPSB0cnVlCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgbGV0IGVzX2RhdGEgPSBbXTsKICAgICAgICAgIGxldCByZXN1bHQgPSBhd2FpdCByZXNwb25zZTsKICAgICAgICAgIGxldCBkYXRhID0gcmVzdWx0LmhpdHMuaGl0czsKICAgICAgICAgIGlmIChkYXRhLmxlbmd0aCA9PT0gMCAmJiB0aGlzLkNvbmZpZGVuY2UgPiA1NSkgewogICAgICAgICAgICAgIHRoaXMubG93ZXJDb25maWRlbmNlID0gdHJ1ZTsKICAgICAgICAgICAgICB0aGlzLmxvd2VyQ29uZmlkZW5jZU1lc3NhZ2UgPSAnVHJ5IGxvd2VyaW5nIGNvbmZpZGVuY2UgdGhyZXNob2xkJwogICAgICAgICAgfQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHRoaXMubG93ZXJDb25maWRlbmNlID0gZmFsc2U7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBkYXRhLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgZXNfZGF0YS5wdXNoKGRhdGFbaV0uX3NvdXJjZSkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgdGhpcy5lbGFzdGljc2VhcmNoX2RhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGVzX2RhdGEpKTsKICAgICAgICAgIHRoaXMuaXNCdXN5ID0gZmFsc2UKICAgICAgfQogICAgfSwKICB9Cn0K"},{"version":3,"sources":["TechnicalCues.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"TechnicalCues.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div>\n    <div\n      v-if=\"isBusy\"\n      class=\"wrapper\"\n    >\n      <Loading />\n    </div>\n    <div\n      v-else\n      class=\"wrapper\"\n    >\n      <b-table\n        responsive\n        fixed\n        :items=\"elasticsearch_data\"\n        :per-page=\"perPage\"\n        :current-page=\"currentPage\"\n        :fields=\"fields\"\n        :sort-by=\"sortBy\"\n      >\n        <template #cell(Type)=\"data\">\n          <b-button variant=\"link\" @click=\"setPlayerTime(data.item.EndTimestamp, data.item.StartTimestamp)\">\n            {{ data.item.Type }}\n          </b-button>\n        </template>\n      </b-table>\n      <b-pagination\n        v-model=\"currentPage\"\n        align=\"center\"\n        :per-page=\"perPage\"\n        :total-rows=\"rows\"\n        aria-controls=\"shotTable\"\n      ></b-pagination>\n      <b-button\n        type=\"button\"\n        @click=\"saveFile()\"\n      >\n        Download Data\n      </b-button>\n      <br>\n      <b-button\n          :pressed=\"false\"\n          size=\"sm\"\n          variant=\"link\"\n          class=\"text-decoration-none\"\n          @click=\"showElasticsearchApiRequest = true\"\n      >\n        Show API request to get these results\n      </b-button>\n      <b-modal\n          v-model=\"showElasticsearchApiRequest\"\n          scrollable\n          title=\"SEARCH API\"\n          ok-only\n      >\n        <label>Request URL:</label>\n        <pre v-highlightjs><code class=\"bash\">GET {{ ELASTICSEARCH_ENDPOINT }}workflow/execution</code></pre>\n        <label>Search query:</label>\n        <pre v-highlightjs=\"JSON.stringify(searchQuery)\"><code class=\"json\"></code></pre>\n        <label>Sample command:</label>\n        <pre v-highlightjs=\"curlCommand\"><code class=\"bash\"></code></pre>\n      </b-modal>\n    </div>\n  </div>\n</template>\n\n<script>\n  import Loading from '@/components/Loading.vue'\n  import { mapState } from 'vuex'\n  export default {\n    name: \"TechnicalCues\",\n    components: {\n      Loading\n    },\n    props: {\n      mediaType: {\n        type: String,\n        default: \"\"\n      },\n    },\n    data() {\n      return {\n        curlCommand: '',\n        searchQuery: '',\n        showElasticsearchApiRequest: false,\n        sortBy: 'StartTimecodeSMPTE',\n        currentPage: 1,\n        perPage: 5,\n        endTimestamp: null,\n        fields: [\n          {\n            'Type': {\n              label: 'Type',\n              sortable: true\n            }\n          },\n          {\n            'StartTimecodeSMPTE': {\n              label: 'Start',\n              sortable: true\n            }\n          },\n          {\n            'EndTimecodeSMPTE': {\n              label: 'End',\n              sortable: false\n              }\n          },\n          {\n            'DurationSMPTE': {\n              label: 'Duration',\n              sortable: true\n              }\n          },\n          { key: 'Confidence', sortable: true }\n        ],\n        elasticsearch_data: [],\n        isBusy: false,\n        operator: 'technical_cue_detection',\n      }\n    },\n    computed: {\n      ...mapState(['player']),\n      ...mapState(['current_time']),\n      rows() {\n        return this.elasticsearch_data.length\n      }\n    },\n    watch: {\n      current_time(time) {\n        if (this.endTimestamp != null) {\n          if (time == this.endTimestamp || time > this.endTimestamp) {\n            this.player.pause();\n            this.endTimestamp = null\n          }\n        }\n      }\n    },\n    mounted: function() {\n      this.getCurlCommand();\n    },\n    beforeDestroy: function () {\n      this.elasticsearch_data = [];\n    },\n    deactivated: function () {\n      console.log('deactivated component:', this.operator);\n    },\n    activated: function () {\n      console.log('activated component:', this.operator)\n      this.fetchAssetData();\n    },\n    methods: {\n      getCurlCommand() {\n        this.searchQuery = 'AssetId:'+this.$route.params.asset_id+' Operator:'+this.operator;\n        // get curl command to search elasticsearch\n        this.curlCommand = 'awscurl -X GET --profile default --service es --region ' + this.AWS_REGION + ' \\'' + this.ELASTICSEARCH_ENDPOINT + '/_search?q=' + encodeURIComponent(this.searchQuery) + '\\''\n      },\n      setPlayerTime(endMillisenconds, startMilliseconds) {\n        this.endTimestamp = endMillisenconds / 1000\n        let seconds = startMilliseconds / 1000\n        this.player.currentTime(seconds);\n        this.player.play();\n      },\n      saveFile() {\n        const elasticsearch_data = JSON.stringify(this.elasticsearch_data);\n        const blob = new Blob([elasticsearch_data], {type: 'text/plain'});\n        const e = document.createEvent('MouseEvents'),\n          a = document.createElement('a');\n        a.download = \"data.json\";\n        a.href = window.URL.createObjectURL(blob);\n        a.dataset.downloadurl = ['text/json', a.download, a.href].join(':');\n        e.initEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\n        a.dispatchEvent(e);\n      },\n      async fetchAssetData () {\n          let query = 'AssetId:'+this.$route.params.asset_id+' Operator:'+this.operator;\n          let apiName = 'contentAnalysisElasticsearch';\n          let path = '/_search';\n          let apiParams = {\n            headers: {'Content-Type': 'application/json'},\n            queryStringParameters: {'q': this.searchQuery, 'default_operator': 'AND', 'size': 10000}\n          };\n          let response = await this.$Amplify.API.get(apiName, path, apiParams);\n          console.log(response)\n          if (!response) {\n            this.showElasticSearchAlert = true\n          }\n          else {\n            let es_data = [];\n            let result = await response;\n            let data = result.hits.hits;\n            if (data.length === 0 && this.Confidence > 55) {\n                this.lowerConfidence = true;\n                this.lowerConfidenceMessage = 'Try lowering confidence threshold'\n            }\n            else {\n              this.lowerConfidence = false;\n              for (let i = 0, len = data.length; i < len; i++) {\n                es_data.push(data[i]._source)\n              }\n            }\n            this.elasticsearch_data = JSON.parse(JSON.stringify(es_data));\n            this.isBusy = false\n        }\n      },\n    }\n  }\n</script>\n"]}]}