{"remainingRequest":"/Users/ianwow/development/aws-content-analysis/source/website/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/ianwow/development/aws-content-analysis/source/website/src/components/ShotDetection.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/ianwow/development/aws-content-analysis/source/website/src/components/ShotDetection.vue","mtime":1642006298146},{"path":"/Users/ianwow/development/aws-content-analysis/source/website/node_modules/cache-loader/dist/cjs.js","mtime":1633407346687},{"path":"/Users/ianwow/development/aws-content-analysis/source/website/node_modules/babel-loader/lib/index.js","mtime":1633407348173},{"path":"/Users/ianwow/development/aws-content-analysis/source/website/node_modules/cache-loader/dist/cjs.js","mtime":1633407346687},{"path":"/Users/ianwow/development/aws-content-analysis/source/website/node_modules/vue-loader/lib/index.js","mtime":1633407348650}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBMb2FkaW5nIGZyb20gJ0AvY29tcG9uZW50cy9Mb2FkaW5nLnZ1ZScKaW1wb3J0IHsgbWFwU3RhdGUgfSBmcm9tICd2dWV4JwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIlNob3REZXRlY3Rpb24iLAogIGNvbXBvbmVudHM6IHsKICAgIExvYWRpbmcKICB9LAogIHByb3BzOiB7CiAgICBtZWRpYVR5cGU6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAiIgogICAgfSwKICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBjdXJsQ29tbWFuZDogJycsCiAgICAgIHNlYXJjaFF1ZXJ5OiAnJywKICAgICAgc2hvd0VsYXN0aWNzZWFyY2hBcGlSZXF1ZXN0OiBmYWxzZSwKICAgICAgc29ydEJ5OiAnSW5kZXgnLAogICAgICBjdXJyZW50UGFnZTogMSwKICAgICAgcGVyUGFnZTogMTAsCiAgICAgIGVuZFRpbWVzdGFtcDogbnVsbCwKICAgICAgZmllbGRzOiBbCiAgICAgICAgewogICAgICAgICAgJ0luZGV4JzogewogICAgICAgICAgICBsYWJlbDogJ1Nob3QgTnVtYmVyJywKICAgICAgICAgICAgc29ydGFibGU6IHRydWUKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICdTdGFydFRpbWVjb2RlU01QVEUnOiB7CiAgICAgICAgICAgIGxhYmVsOiAnU3RhcnQnLAogICAgICAgICAgICBzb3J0YWJsZTogZmFsc2UKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICdFbmRUaW1lY29kZVNNUFRFJzogewogICAgICAgICAgICBsYWJlbDogJ0VuZCcsCiAgICAgICAgICAgIHNvcnRhYmxlOiBmYWxzZQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAnRHVyYXRpb25TTVBURSc6IHsKICAgICAgICAgICAgbGFiZWw6ICdEdXJhdGlvbicsCiAgICAgICAgICAgIHNvcnRhYmxlOiB0cnVlCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHsga2V5OiAnQ29uZmlkZW5jZScsIHNvcnRhYmxlOiB0cnVlIH0KICAgIF0sCiAgICAgIGVsYXN0aWNzZWFyY2hfZGF0YTogW10sCiAgICAgIGlzQnVzeTogZmFsc2UsCiAgICAgIG9wZXJhdG9yOiAnc2hvdF9kZXRlY3Rpb24nLAogICAgfQogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcFN0YXRlKFsncGxheWVyJ10pLAogICAgLi4ubWFwU3RhdGUoWydjdXJyZW50X3RpbWUnXSksCiAgICByb3dzKCkgewogICAgICByZXR1cm4gdGhpcy5lbGFzdGljc2VhcmNoX2RhdGEubGVuZ3RoCiAgICB9LAogIH0sCiAgd2F0Y2g6IHsKICAgIGN1cnJlbnRfdGltZSh0aW1lKSB7CiAgICAgIGlmICh0aGlzLmVuZFRpbWVzdGFtcCAhPSBudWxsKSB7CiAgICAgICAgaWYgKHRpbWUgPT0gdGhpcy5lbmRUaW1lc3RhbXAgfHwgdGltZSA+IHRoaXMuZW5kVGltZXN0YW1wKSB7CiAgICAgICAgICB0aGlzLnBsYXllci5wYXVzZSgpOwogICAgICAgICAgdGhpcy5lbmRUaW1lc3RhbXAgPSBudWxsCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSwKICBkZWFjdGl2YXRlZDogZnVuY3Rpb24gKCkgewogICAgY29uc29sZS5sb2coJ2RlYWN0aXZhdGVkIGNvbXBvbmVudDonLCB0aGlzLm9wZXJhdG9yKTsKICB9LAogIGFjdGl2YXRlZDogZnVuY3Rpb24gKCkgewogICAgY29uc29sZS5sb2coJ2FjdGl2YXRlZCBjb21wb25lbnQ6JywgdGhpcy5vcGVyYXRvcikKICAgIHRoaXMuZmV0Y2hBc3NldERhdGEoKTsKICB9LAogIG1vdW50ZWQ6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5nZXRDdXJsQ29tbWFuZCgpOwogIH0sCiAgYmVmb3JlRGVzdHJveTogZnVuY3Rpb24gKCkgewogICAgdGhpcy5lbGFzdGljc2VhcmNoX2RhdGEgPSBbXTsKICB9LAogIG1ldGhvZHM6IHsKICAgIHNldFBsYXllclRpbWUoZW5kTWlsbGlzZW5jb25kcywgc3RhcnRNaWxsaXNlY29uZHMpIHsKICAgICAgdGhpcy5lbmRUaW1lc3RhbXAgPSBlbmRNaWxsaXNlbmNvbmRzIC8gMTAwMAogICAgICBsZXQgc2Vjb25kcyA9IHN0YXJ0TWlsbGlzZWNvbmRzIC8gMTAwMAogICAgICB0aGlzLnBsYXllci5jdXJyZW50VGltZShzZWNvbmRzKQogICAgICB0aGlzLnBsYXllci5wbGF5KCk7CiAgICB9LAogICAgZ2V0Q3VybENvbW1hbmQoKSB7CiAgICAgIHRoaXMuc2VhcmNoUXVlcnkgPSAnQXNzZXRJZDonK3RoaXMuJHJvdXRlLnBhcmFtcy5hc3NldF9pZCsnIE9wZXJhdG9yOicrdGhpcy5vcGVyYXRvcjsKICAgICAgLy8gZ2V0IGN1cmwgY29tbWFuZCB0byBzZWFyY2ggZWxhc3RpY3NlYXJjaAogICAgICB0aGlzLmN1cmxDb21tYW5kID0gJ2F3c2N1cmwgLVggR0VUIC0tcHJvZmlsZSBkZWZhdWx0IC0tc2VydmljZSBlcyAtLXJlZ2lvbiAnICsgdGhpcy5BV1NfUkVHSU9OICsgJyBcJycgKyB0aGlzLkVMQVNUSUNTRUFSQ0hfRU5EUE9JTlQgKyAnL19zZWFyY2g/cT0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuc2VhcmNoUXVlcnkpICsgJ1wnJwogICAgfSwKICAgIHNhdmVGaWxlKCkgewogICAgICBjb25zdCBlbGFzdGljc2VhcmNoX2RhdGEgPSBKU09OLnN0cmluZ2lmeSh0aGlzLmVsYXN0aWNzZWFyY2hfZGF0YSk7CiAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbZWxhc3RpY3NlYXJjaF9kYXRhXSwge3R5cGU6ICd0ZXh0L3BsYWluJ30pOwogICAgICBjb25zdCBlID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ01vdXNlRXZlbnRzJyksCiAgICAgICAgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgICAgYS5kb3dubG9hZCA9ICJkYXRhLmpzb24iOwogICAgICBhLmhyZWYgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsKICAgICAgYS5kYXRhc2V0LmRvd25sb2FkdXJsID0gWyd0ZXh0L2pzb24nLCBhLmRvd25sb2FkLCBhLmhyZWZdLmpvaW4oJzonKTsKICAgICAgZS5pbml0RXZlbnQoJ2NsaWNrJywgdHJ1ZSwgZmFsc2UsIHdpbmRvdywgMCwgMCwgMCwgMCwgMCwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDAsIG51bGwpOwogICAgICBhLmRpc3BhdGNoRXZlbnQoZSk7CiAgICB9LAogICAgYXN5bmMgZmV0Y2hBc3NldERhdGEgKCkgewogICAgICAgIGxldCBxdWVyeSA9ICdBc3NldElkOicrdGhpcy4kcm91dGUucGFyYW1zLmFzc2V0X2lkKycgT3BlcmF0b3I6Jyt0aGlzLm9wZXJhdG9yOwogICAgICAgIGxldCBhcGlOYW1lID0gJ2NvbnRlbnRBbmFseXNpc0VsYXN0aWNzZWFyY2gnOwogICAgICAgIGxldCBwYXRoID0gJy9fc2VhcmNoJzsKICAgICAgICBsZXQgYXBpUGFyYW1zID0gewogICAgICAgICAgaGVhZGVyczogeydDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbid9LAogICAgICAgICAgcXVlcnlTdHJpbmdQYXJhbWV0ZXJzOiB7J3EnOiB0aGlzLnNlYXJjaFF1ZXJ5LCAnZGVmYXVsdF9vcGVyYXRvcic6ICdBTkQnLCAnc2l6ZSc6IDEwMDAwfQogICAgICAgIH07CiAgICAgICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy4kQW1wbGlmeS5BUEkuZ2V0KGFwaU5hbWUsIHBhdGgsIGFwaVBhcmFtcyk7CiAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpCiAgICAgICAgaWYgKCFyZXNwb25zZSkgewogICAgICAgICAgdGhpcy5zaG93RWxhc3RpY1NlYXJjaEFsZXJ0ID0gdHJ1ZQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgIGxldCBlc19kYXRhID0gW107CiAgICAgICAgICBsZXQgcmVzdWx0ID0gYXdhaXQgcmVzcG9uc2U7CiAgICAgICAgICBsZXQgZGF0YSA9IHJlc3VsdC5oaXRzLmhpdHM7CiAgICAgICAgICBpZiAoZGF0YS5sZW5ndGggPT09IDAgJiYgdGhpcy5Db25maWRlbmNlID4gNTUpIHsKICAgICAgICAgICAgICB0aGlzLmxvd2VyQ29uZmlkZW5jZSA9IHRydWU7CiAgICAgICAgICAgICAgdGhpcy5sb3dlckNvbmZpZGVuY2VNZXNzYWdlID0gJ1RyeSBsb3dlcmluZyBjb25maWRlbmNlIHRocmVzaG9sZCcKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgewogICAgICAgICAgICB0aGlzLmxvd2VyQ29uZmlkZW5jZSA9IGZhbHNlOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gZGF0YS5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICAgIGVzX2RhdGEucHVzaChkYXRhW2ldLl9zb3VyY2UpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuZWxhc3RpY3NlYXJjaF9kYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShlc19kYXRhKSk7CiAgICAgICAgICB0aGlzLmlzQnVzeSA9IGZhbHNlCiAgICAgIH0KICAgIH0KICB9Cn0K"},{"version":3,"sources":["ShotDetection.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ShotDetection.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div>\n    <div\n      v-if=\"isBusy\"\n      class=\"wrapper\"\n    >\n      <Loading />\n    </div>\n    <div\n      v-else\n      class=\"wrapper\"\n    >\n      <b-table\n        id=\"shotTable\"\n        responsive\n        fixed\n        :items=\"elasticsearch_data\"\n        :per-page=\"perPage\"\n        :current-page=\"currentPage\"\n        :fields=\"fields\"\n        :sort-by=\"sortBy\"\n      >\n        <template #cell(Index)=\"data\">\n          <b-button variant=\"link\" @click=\"setPlayerTime(data.item.EndTimestamp, data.item.StartTimestamp)\">\n            {{ data.item.Index }}\n          </b-button>\n        </template>\n      </b-table>\n      <b-pagination\n        v-model=\"currentPage\"\n        align=\"center\"\n        :per-page=\"perPage\"\n        :total-rows=\"rows\"\n        aria-controls=\"shotTable\"\n      ></b-pagination>\n      <b-button\n        type=\"button\"\n        @click=\"saveFile()\"\n      >\n        Download Data\n      </b-button>\n      <br>\n      <b-button\n          :pressed=\"false\"\n          size=\"sm\"\n          variant=\"link\"\n          class=\"text-decoration-none\"\n          @click=\"showElasticsearchApiRequest = true\"\n      >\n        Show API request to get these results\n      </b-button>\n      <b-modal\n          v-model=\"showElasticsearchApiRequest\"\n          scrollable\n          title=\"SEARCH API\"\n          ok-only\n      >\n        <label>Request URL:</label>\n        <pre v-highlightjs><code class=\"bash\">GET {{ ELASTICSEARCH_ENDPOINT }}workflow/execution</code></pre>\n        <label>Search query:</label>\n        <pre v-highlightjs=\"JSON.stringify(searchQuery)\"><code class=\"json\"></code></pre>\n        <label>Sample command:</label>\n        <pre v-highlightjs=\"curlCommand\"><code class=\"bash\"></code></pre>\n      </b-modal>\n    </div>\n  </div>\n</template>\n\n<script>\n  import Loading from '@/components/Loading.vue'\n  import { mapState } from 'vuex'\n  export default {\n    name: \"ShotDetection\",\n    components: {\n      Loading\n    },\n    props: {\n      mediaType: {\n        type: String,\n        default: \"\"\n      },\n    },\n    data() {\n      return {\n        curlCommand: '',\n        searchQuery: '',\n        showElasticsearchApiRequest: false,\n        sortBy: 'Index',\n        currentPage: 1,\n        perPage: 10,\n        endTimestamp: null,\n        fields: [\n          {\n            'Index': {\n              label: 'Shot Number',\n              sortable: true\n            }\n          },\n          {\n            'StartTimecodeSMPTE': {\n              label: 'Start',\n              sortable: false\n            }\n          },\n          {\n            'EndTimecodeSMPTE': {\n              label: 'End',\n              sortable: false\n              }\n          },\n          {\n            'DurationSMPTE': {\n              label: 'Duration',\n              sortable: true\n              }\n          },\n          { key: 'Confidence', sortable: true }\n      ],\n        elasticsearch_data: [],\n        isBusy: false,\n        operator: 'shot_detection',\n      }\n    },\n    computed: {\n      ...mapState(['player']),\n      ...mapState(['current_time']),\n      rows() {\n        return this.elasticsearch_data.length\n      },\n    },\n    watch: {\n      current_time(time) {\n        if (this.endTimestamp != null) {\n          if (time == this.endTimestamp || time > this.endTimestamp) {\n            this.player.pause();\n            this.endTimestamp = null\n          }\n        }\n      }\n    },\n    deactivated: function () {\n      console.log('deactivated component:', this.operator);\n    },\n    activated: function () {\n      console.log('activated component:', this.operator)\n      this.fetchAssetData();\n    },\n    mounted: function() {\n      this.getCurlCommand();\n    },\n    beforeDestroy: function () {\n      this.elasticsearch_data = [];\n    },\n    methods: {\n      setPlayerTime(endMillisenconds, startMilliseconds) {\n        this.endTimestamp = endMillisenconds / 1000\n        let seconds = startMilliseconds / 1000\n        this.player.currentTime(seconds)\n        this.player.play();\n      },\n      getCurlCommand() {\n        this.searchQuery = 'AssetId:'+this.$route.params.asset_id+' Operator:'+this.operator;\n        // get curl command to search elasticsearch\n        this.curlCommand = 'awscurl -X GET --profile default --service es --region ' + this.AWS_REGION + ' \\'' + this.ELASTICSEARCH_ENDPOINT + '/_search?q=' + encodeURIComponent(this.searchQuery) + '\\''\n      },\n      saveFile() {\n        const elasticsearch_data = JSON.stringify(this.elasticsearch_data);\n        const blob = new Blob([elasticsearch_data], {type: 'text/plain'});\n        const e = document.createEvent('MouseEvents'),\n          a = document.createElement('a');\n        a.download = \"data.json\";\n        a.href = window.URL.createObjectURL(blob);\n        a.dataset.downloadurl = ['text/json', a.download, a.href].join(':');\n        e.initEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\n        a.dispatchEvent(e);\n      },\n      async fetchAssetData () {\n          let query = 'AssetId:'+this.$route.params.asset_id+' Operator:'+this.operator;\n          let apiName = 'contentAnalysisElasticsearch';\n          let path = '/_search';\n          let apiParams = {\n            headers: {'Content-Type': 'application/json'},\n            queryStringParameters: {'q': this.searchQuery, 'default_operator': 'AND', 'size': 10000}\n          };\n          let response = await this.$Amplify.API.get(apiName, path, apiParams);\n          console.log(response)\n          if (!response) {\n            this.showElasticSearchAlert = true\n          }\n          else {\n            let es_data = [];\n            let result = await response;\n            let data = result.hits.hits;\n            if (data.length === 0 && this.Confidence > 55) {\n                this.lowerConfidence = true;\n                this.lowerConfidenceMessage = 'Try lowering confidence threshold'\n            }\n            else {\n              this.lowerConfidence = false;\n              for (let i = 0, len = data.length; i < len; i++) {\n                es_data.push(data[i]._source)\n              }\n            }\n            this.elasticsearch_data = JSON.parse(JSON.stringify(es_data));\n            this.isBusy = false\n        }\n      }\n    }\n  }\n</script>\n"]}]}